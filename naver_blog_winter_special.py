import os
import google.generativeai as genai
from datetime import datetime

# ==========================================
# 1. 설정 (Setup)
# ==========================================

api_key = os.environ.get("GOOGLE_API_KEY")

# 블로그 설정 (겨울방학/특강 시즌 공략형)
STUDIO_NAME = "다산 라미 바이올린"
LOCATION = "남양주 다산신도시"

# VIBE: 체계적인 커리큘럼을 제시하는 '교육 컨설턴트/전략가' 느낌
TEACHER_VIBE = "결과로 증명하는, 체계적인 로드맵을 제시하는 교육 전략가"

# ==========================================
# 2. '겨울방학 특강' 전문 블로그 생성기 (Season Prompt)
# ==========================================
def generate_winter_special_post(topic, curriculum_notes):
    
    prompt = f"""
    당신은 {LOCATION}에서 활동하는 바이올린 교육 전략가이자 '{TEACHER_VIBE}' 선생님입니다.
    이번 글의 목적은 **'겨울방학 특강 모집'**과 **'단기간 실력 향상'**을 어필하여 개인레슨 수강생을 모집하는 것입니다.
    학부모들이 **"이번 방학은 여기다!"**라고 느끼게 만들어야 합니다.
    
    [입력 소스]
    - 특강 주제: {topic}
    - 커리큘럼/강조점: "{curriculum_notes}"

    [❄️ 핵심 지령: '골든타임'을 강조하는 설득적 글쓰기]
    1. **제목(Title) 전략**:
       - 시기성 강조: "이번 겨울방학이 기회인 이유", "새 학기 전 필수 코스"
       - 구체적 목표: "4주 만에 자세 교정하기", "스즈키 1권, 방학 동안 끝내기"
       - 지역명 포함: "다산신도시 초등맘 주목"
       - *위 전략을 섞어 '지금 아니면 안 될 것 같은' 매력적인 제목 3가지를 먼저 제안하고, 그 중 하나로 글을 시작하세요.*
    
    2. **내용 구성 (흐름)**: 
       - **(위기감 조성)**: "겨울방학 2달, 그냥 흘려보내시겠습니까?" 스마트폰만 보는 아이들, 무너진 생활 습관 등을 언급하며 경각심을 주세요.
       - **(기회 제시)**: "바이올린, 시작하기에 겨울만큼 좋은 계절은 없습니다." (집중하기 좋음, 새 학기 자신감 등).
       - **(커리큘럼)**: 선생님의 메모({curriculum_notes})를 바탕으로 **주차별(Week 1~4) 계획**이나 **확실한 목표(비포/애프터)**를 표나 리스트 형식으로 보여주세요. 체계성을 강조해야 합니다.
       - **(희소성)**: "소수 정예로 꼼꼼하게 지도하기 위해 타임별 정원이 적습니다.", "조기 마감 주의" 등 빠른 문의를 유도하세요.

    3. **톤앤매너**:
       - 확신에 찬 어조. ("~할 수 있습니다", "~약속드립니다")
       - 감성보다는 **'팩트'와 '계획'** 위주.
       - 전문적인 느낌을 주는 단어 선택 (집중 케어, 마스터 클래스, 솔루션 등).

    4. **형식**:
       - 중간중간 `[사진: 특강 교재/커리큘럼 표]` 또는 `[사진: 열정적으로 연습하는 아이들]` 가이드를 넣어 현장감을 주세요.

    [목표]
    글을 다 읽은 학부모가 "이 커리큘럼이면 우리 애도 늘겠구나"라고 확신하고 바로 상담 전화를 걸게 만드는 것.
    """

    if not api_key:
        return "⚠️ API 키를 먼저 설정해주세요!"

    try:
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel('gemini-2.0-flash')
        
        print(f"❄️ 겨울방학 특강(Season Ver.) 글 쓰는 중... (주제: {topic})")
        response = model.generate_content(prompt)
        return response.text
        
    except Exception as e:
        return f"❌ 에러가 발생했습니다: {e}"

# ==========================================
# 3. 실행 (Run)
# ==========================================
if __name__ == "__main__":
    print(f"--- {STUDIO_NAME} 블로그 포스팅 도우미 (Winter Special) ---")
    
    # 입력 예시 가이드
    print("팁: 구체적인 '목표'나 '주차별 계획'을 넣어주면 AI가 훨씬 체계적인 글을 씁니다.")
    print("예: '4주 동안 활 잡기부터 작은별 변주곡까지 완성. 자세 교정 집중반.'\n")

    topic_in = input("특강 주제 (예: 겨울방학 4주 자세 교정 클리닉): ")
    notes_in = input("커리큘럼/강조점 (예: 1주차 기본기, 2주차 음정, 3주차 소곡...): ")

    if not topic_in: topic_in = "다산신도시 초등학생, 이번 겨울방학에 '바이올린 기본기' 완벽 마스터하기"
    if not notes_in: notes_in = "겨울방학은 기본기 잡기 딱 좋음. 학교 안 가니까 연습 시간 많음. 1:1로 손 모양, 활 각도 집중 교정. 잘못된 습관 고치는 '자세 클리닉' 운영. 3월 새 학기에 오케스트라 들어갈 수 있게 준비."

    post = generate_winter_special_post(topic_in, notes_in)

    # 파일 저장
    filename = f"blog_winter_{datetime.now().strftime('%H%M%S')}.md"
    with open(filename, "w", encoding="utf-8") as f:
        f.write(post)

    print(f"\n✅ 특강 홍보 원고 작성 완료! '{filename}' 파일을 확인해 주세요.")
    print("지금 올리셔야 1월 수강생 꽉 찹니다!")